<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>JAVA</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1">
	<script src="libs/encoding.js"></script>
	<script type="text/javascript" src="config/default.js" defer></script>
	<script type="text/javascript" src="config/runtests.js" defer></script>
	<script type="text/javascript" src="config/build.js" defer></script>
	<script type="text/javascript" src="config/urlparams.js" defer></script>
	<script type="text/javascript" src="libs/promise-6.0.0.js" defer></script>
	<script type="text/javascript" src="polyfill/IndexedDB-getAll-shim.js" defer></script>
	<script type="text/javascript" src="libs/compiled-method-cache.js" defer></script>
	<script type="text/javascript" src="bld/native.js" defer></script>
	<script type="text/javascript" src="bld/j2me.js" defer></script>
	<script type="text/javascript" src="bld/main-all.js" defer></script>
	<script type="text/javascript" src="kaiads.v5.min.js" defer></script>

	<style>
		body {
			padding: 30px 8px 30px 8px;
			margin: 0px;
		}

		* {
			box-sizing: border-box;
		}

		a {
			text-decoration: none;
			color: #000;
		}

		.header {
			display: block;
			width: 100%;
			padding: 5px 0;
			text-align: center;
			font-size: 1em;
			background-color: black;
			color: #fff;
			position: fixed;
			top: 0;
			left: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap
		}

		.footer {
			width: 100%;
			display: flex;
			text-align: center;
			position: fixed;
			bottom: 0;
			left: 0;
			background-color: black;
		}

		.footerelement {
			display: inline-block;
			width: 33%;
			font-size: 1em;
			font-weight: bold;
			color: #fff;
			padding: 5px 0;
			text-align: center;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap
		}

		.game {
			text-align: center;
			border: 3px solid transparent;
			margin-right: 10px;
			padding: 0px;
			border-radius: 5px;
			text-align: center;
			margin-top: 10px;
			outline-width: 1px;
			outline-color: silver;
			outline-style: solid;
			font-size: 15px;
			padding: 0px;
			width: 63px;
		}

		.game:focus {
			outline-color: transparent;
			border: 3px solid rgb(0, 0, 0);
		}

		.game>.version {
			padding: 0px 15px
		}

		.game:focus>.version {
			background: linear-gradient(#000, #555, #000);
			color: white;
		}


		.menubar {
			position: fixed;
			width: 60%;
			background-color: black;
			left: 0;
			bottom: 31px
		}

		.menuelement {
			width: 100%;
			color: white;
			border: 1px solid #000;
			padding: 5px 3px;
			font-size: 15px
		}

		.menuelement:hover,
		.menuelement:focus {
			background-color: white;
			color: #000;
			cursor: pointer
		}


		.screeninput {
			display: inline-block;
			width: 40%;
			padding: 5px;
			margin: 5px;
			border: 2px solid #ccc;
			border-radius: 5px;
			color: black;
		}

		.screeninput:hover,
		.screeninput:focus {
			background: #8bdcff;
		}
	</style>
</head>

<body>
	<div class="header">Installed Files</div>
	<div class="content">
		<div id="pageContainer" style="display: none;">
			<pre id="consoleContainer"></pre>
			<div id="profilerContainer">
				<div id="profilerToolbar">
					<div class="toolbarLabel">Profiler <span id="profilerMessage" class="toolbarMessage">6
							Seconds</span></div>
					<div id="profilerButtons">
						<div id="profilerStartStop">Start</div>
						<div id="profilerAdjustHeight">Height</div>
					</div>
				</div>
				<div id="profiler">
					<div id="profileList">
					</div>
					<div id="profilePanel">
					</div>
				</div>
			</div>
		</div>


		<pre id="raw-console" style="display: none"></pre>

		<div id="display-container" style="display: none;">
			<div id="display">
				<section id="sidebar" data-type="sidebar" style="display:none">
					<header>
						<h1>Menu</h1>
					</header>
					<nav>
						<ul>
						</ul>
					</nav>
				</section>
				<section id="drawer" role="region">
					<header style="display:none">
						<a href="#"><span class="icon icon-menu">hide sidebar</span></a>
						<a id="header-drawer-button" href="#drawer"><span class="icon icon-menu">show sidebar</span></a>
						<menu id="header-ok-button" type="toolbar" style="display:none"><button>√</button></menu>
						<h1 id="display_title"></h1>
					</header>
					<div id="main" role="main">
						<canvas id="canvas" style="max-width: 100%; max-height: 100%;"></canvas>
						<input id="password-editor" class="text-editor" type="password">
						<input id="tel-editor" class="text-editor" type="tel">
						<input id="number-editor" class="text-editor" type="number">
						<input id="email-editor" class="text-editor" type="email">
						<input id="url-editor" class="text-editor" type="url">
						<div id="textarea-editor" class="text-editor" contenteditable="true"></div>
						<div id="hidden-textarea-editor" class="text-editor"></div>
						<button id="back-button">Back</button>
					</div>
				</section>

				<div id="gamepad" onselectstart='return false' οnselect='document.selection.empty()'>
					<div id="padcontent">
						<button>1</button>
						<button>2</button>
						<button>3</button>
						<button>L</button>
						<div></div>
						<button>R</button>
					</div>
					<div id="padcontent">
						<button>4</button>
						<button>5</button>
						<button>6</button>
						<div></div>
						<button>up</button>
					</div>
					<div id="padcontent">
						<button>7</button>
						<button>8</button>
						<button>9</button>
						<button>left</button>
						<button>OK</button>
						<button>right</button>
					</div>
					<div id="padcontent">
						<button>*</button>
						<button>0</button>
						<button>#</button>
						<div></div>
						<button>down</button>
					</div>
				</div>

				<div id="download-screen" class="screen">
					<h1 class="title">Loading ...</h1>
					<div class="download-progress-container">
						<progress class="pack-activity" value="0" max="100"></progress>
					</div>
				</div>

				<div id="splash-screen" class="screen">
					<h1 class="title">Starting midlet…</h1>
					<div class="splash-progress-container">
						<progress></progress>
					</div>
				</div>

				<div id="exit-screen" class="screen">
				</div>

				<div id="background-screen">
				</div>

				<form role="dialog" data-type="confirm" class="lcdui-alert" id="lcdui-alert" style="display: none">
					<section>
						<h1 class="title"></h1>
						<p class="text"></p>
						<p style="border-top: 0"><progress style="display: none"></progress></p>
					</section>
					<menu>
						<button class="button0" style="display: none"></button>
						<button class="button1" style="display: none"></button>
					</menu>
				</form>

				<form role="dialog" data-type="confirm" class="sms-listener-prompt" id="sms-listener-prompt"
					style="display: none">
					<section>
						<h1>SMS Verification</h1>
						<p class="verificationText"></p>
						<input type="text" placeholder="Type SMS Here">
						<p class="timeLeft"></p>
						<progress class="timeLeftBar" value="0" max="100"></progress>
					</section>
					<menu>
						<button class="cancel">Cancel</button>
						<button class="recommend">Done</button>
					</menu>
				</form>

				<form role="dialog" data-type="confirm" class="nokia-fileui-prompt" id="nokia-fileui-prompt"
					style="display: none">
					<section>
						<h1>Select a file</h1>
						<p><input type="file" name="nokia-fileui-file">
					</section>
					<menu>
						<button class="cancel">Cancel</button>
						<button class="recommend">Done</button>
					</menu>
				</form>

				<form role="dialog" data-type="confirm" class="download-failure-dialog" id="download-failure-dialog"
					style="display: none">
					<section>
						<h1 class="download-dialog-text">Download failure</h1>
						<p>The download of midlet failed. Press <i>Retry</i> to try again.</p>
					</section>
					<menu>
						<button class="recommend">Retry</button>
					</menu>
				</form>
			</div>
			<div id="settings">
				<section>
					<table id="counters">
						<tr>
							<td>Bytecode:</td>
							<td><span id="bytecodeCount"></span></td>
						</tr>
						<tr>
							<td>Compiled:</td>
							<td><span id="compiledCount"></span></td>
						</tr>
						<tr>
							<td>Interpreter:</td>
							<td><span id="interpreterCount"></span></td>
						</tr>
						<tr>
							<td>OSR:</td>
							<td><span id="onStackReplacementCount"></span></td>
						</tr>
						<tr>
							<td>Unwind:</td>
							<td><span id="unwindCount"></span></td>
						</tr>
						<tr>
							<td>Preemption:</td>
							<td><span id="preemptionCount"></span></td>
						</tr>
					</table>
				</section>
				<section>
					<select id="loglevel">
						<option value="0">Log Level: Trace
						<option value="1">Log Level: Log
						<option value="2">Log Level: Info
						<option value="3">Log Level: Warn
						<option value="4">Log Level: Error
						<option value="5">Log Level: Silent
					</select>
					<input id="console-filter-input" type="text" placeholder="Filter Console Output" value="">
					<button id="console-clear">Clear console</button>
					<button id="console-save">Save console</button>
					<label><input type="checkbox" id="perfWriter">Perf</label>
				</section>
				<section>
					<button id="exportstorage">Export File System</button>
					<div>Import File System:</div>
					<input type="file" id="importstoragefile">
					<input type="text" id="importstorageurl" placeholder="URL to FS backup">
					<button id="importstorage">Import</button>
					<button id="clearCompiledMethodCache">Clear Compiled Method Cache</button>
					<button id="deleteDatabases">Delete IDB Databases</button>
					<button id="printAllExceptions">Print all exceptions: OFF</button>
					<button id="clearCounters">Clear Counters</button>
					<button id="dumpCounters">Dump Counters</button>
					<button id="sampleCounters1">One sample for 1s</button>
					<button id="sampleCounters2">One sample for 100ms (2s)</button>
					<select id="canvasSize1">
						<option value="" selected>Display size: 240x320</option>
						<option value="size-320x240">Display size: 320x240</option>
						<option value="size-320x480">Display size: 320x480</option>
						<option value="size-480x320">Display size: 480x320</option>
					</select>
					<button id="start">Start</button>

				</section>
			</div>
		</div>
	</div>
	<div class="menubar" style="display: none;" id="menubar">
		<div class="menuelement" onclick="openLocalJar()" tabindex="0">Install</div>
		<div class="menuelement" onclick="clearLocalJar()" tabindex="1">Unistall All</div>
		<div class="menuelement" tabindex="2" onclick="window.close();">Quit</div>

	</div>
	<div class="footer">
		<div class="footerelement">Menu</div>
		<div class="footerelement">OK</div>
		<div class="footerelement">Exit</div>
	</div>

	<input id="jarFileupload" accept=".jar" multiple="true" type="file" style="visibility: hidden;display:none;" />


	<script type="text/javascript">

		var header = document.getElementsByClassName('header')[0];
		var f1 = document.querySelectorAll('.footerelement')[0];
		var f2 = document.querySelectorAll('.footerelement')[1];
		var f3 = document.querySelectorAll('.footerelement')[2];
		var app = document.getElementsByClassName('content')[0];
		var tmpf3 = '';
		var tmpf2 = '';
		var menubar = document.getElementById('menubar');
		function openmenubar() {
			tmpf3 = f3.innerHTML;
			tmpf2 = f2.innerHTML;
			document.getElementById('menubar').style.display = 'block';
			document.querySelectorAll('.menuelement')[0].focus();
			f2.innerHTML = 'OK';
			f3.innerHTML = 'Back';
			document.body.style.overflow = 'hidden';
			document.body.removeEventListener('keydown', keydownlisterner);
			document.body.addEventListener('keydown', keydownmenubar);
		}

		function closemenubar() {
			document.body.style.overflow = 'scroll';
			document.getElementById('menubar').style.display = 'none';
			document.body.removeEventListener('keydown', keydownmenubar);
			document.body.addEventListener('keydown', keydownlisterner);
			f3.innerHTML = tmpf3;
			f2.innerHTML = tmpf2;
		}

		function menubarroot(jarName = null, name = 'User Manual') {
			menubar.innerHTML = '<div class="menuelement" onclick="openJar(\'ftu.jar\',\'BookReaderMidlet\');" tabindex="0">Run</div><div class="menuelement" onclick="openLocalJar()" tabindex="1">Install</div><div class="menuelement" onclick="clearLocalJar()" tabindex="2">Unistall All</div><div class="menuelement" tabindex="3" onclick="window.close();">Quit</div>';
			localStorage.setItem('focusedJar', jarName);
			header.innerHTML = name;
		}
		function menubarnonroot(jarName = null, name = 'User Manual') {
			menubar.innerHTML = '<div class="menuelement" onclick="if(localStorage.getItem(\'focusedJar\') !=\'\'){ openJar(localStorage.getItem(\'focusedJar\'), \'\', 1);} else{ alert(\'Please Select One First\');}" tabindex="0">Open</div><div class="menuelement" onclick="setLocalConfig()" tabindex="1">Set Config</div><div class="menuelement" onclick="openLocalJar()" tabindex="2">Install</div><div class="menuelement"onclick="if(localStorage.getItem(\'focusedJar\') !=\'\'){deleteLocalJar()} else{ alert(\'Please Select One First\');}"tabindex="3">Uninstall</div><div class="menuelement" onclick="clearLocalJar()" tabindex="4">Reset All</div><div class="menuelement" tabindex="5" onclick="window.close();">Quit</div>';
			localStorage.setItem('focusedJar', jarName);
			header.innerHTML = name;
		}
		//get file extension
		function fileExtention(filename) {
			var fsplit = filename.split('.');
			var extention = fsplit[fsplit.length - 1];
			return extention;
		}

		//get base file Name
		function baseFileName(filename) {
			var s = filename.split('/');
			var name = s[s.length - 1];
			return name;
		}

		function setLocalConfig() {
			var div = document.createElement('div');
			div.id = 'localconfigbar';
			div.innerHTML = '<div style="background: #ddd">Set Screen Size:</div><div style="color: white;"><input type="tel" class="screeninput" tabindex="0" value="0">x<input type="tel" class="screeninput" tabindex="1"  value="0"></div>';
			div.style = "position: fixed;left: 37%;background-color: black;bottom: 105px;border: 2px solid rgb(221, 221, 221);margin-right: 5px;";
			document.body.appendChild(div);
			document.querySelector('.screeninput').focus();
			f2.innerHTML = 'Save';
			f1.innerHTML = '';
			document.body.removeEventListener('keydown', keydownmenubar);
			document.body.addEventListener('keydown', keydownlocalconfig);
		}

		function processLocalJAD(data) {
			var manifest = {};
			data.replace(/\r\n|\r/g, "\n").replace(/\n /g, "").split("\n").forEach(function (entry) {
				if (entry) {
					var keyEnd = entry.indexOf(":");
					var key = entry.substring(0, keyEnd);
					var val = entry.substring(keyEnd + 1).trim();
					manifest[key] = val;
				}
			});

			return manifest;
		}

		function loadFileFromLocalJAR(jar, fileName) {
			var entry = jar[fileName];
			if (!entry) {
				return null;
			}
			var bytes;
			if (entry.compression_method === 0) {
				bytes = entry.compressed_data;
			} else {
				if (entry.compression_method === 8) {
					bytes = inflate(entry.compressed_data, entry.uncompressed_len);
				} else {
					return null;
				}
			}
			if (!jar.isBuiltIn && fileName.endsWith(".class")) {
				delete jar.directory[fileName];
			}
			return bytes;
		}


		function formatByte2Img(data) {
			var blobUrl = ''
			const bytes = new Uint8Array(data)
			const blob = new Blob([bytes], { type: 'image/png' })
			blobUrl = (window.URL || window.webkitURL).createObjectURL(blob)
			return blobUrl
		}


		function refreshGameList() {
			JARStore.getAll().then(
				(files) => {
					var applist = document.getElementById('gamepanel');
					var listapp = ['<a class="game focusable" href="javascript:void(0)" onclick="openJar(\'ftu.jar\',\'BookReaderMidlet\');" tabindex="0" data-name="User Manual" onfocus="menubarroot();"> <div style="height:64px;"> <img src="img/ftu.png" width="50px" height="50px"></img> </div> <div class="version">Help</div></a>'];
					for (var i = 0; i < files.length; i++) {
						var res = files[i];
						try {


							var mffile = res.jar['META-INF/MANIFEST.MF'];
							mfdata = ''
							switch (mffile.compression_method) {
								case 0:
									mfdata = mffile.compressed_data;
									break;
								case 8:
									mfdata = inflate(mffile.compressed_data, mffile.uncompressed_len);
									break;
							}
							mfdata = new TextDecoder('utf-8').decode(mfdata);
							console.log(mfdata);
							var dts = processLocalJAD(mfdata);
							var a = dts['MIDlet-1'];
							var jarVersion = dts['MIDlet-Version'];
							var a = a.split(',');
							var name = a[0].trim();
							var jarmid = a[2].trim();

							var jaricon = a[1].trim();
							if (jaricon.indexOf("/") == 0) {
								jaricon = jaricon.substring(1);
							}

							var iconfile = res.jar[jaricon];
							if (iconfile == undefined) {
								iconfile = res.jar[dts['MIDlet-Icon'].trim()];
							}
							var iconfiledata = ''
							switch (iconfile.compression_method) {
								case 0:
									iconfiledata = iconfile.compressed_data;
									break;
								case 8:
									iconfiledata = new Uint8Array(inflate(iconfile.compressed_data, iconfile.uncompressed_len));
									break;
							}
							var bytes = iconfiledata;
							var blob = new Blob([bytes], { type: "image/png" });
							var url = URL.createObjectURL(blob);
							if (url == '') { url = 'java.png'; }
							listapp.push('<a class="game focusable" tabindex="' + (i + 1) + '" style="" href="javascript:void(0)" onclick="openJar(\'' + res.jarName + '\',0,1);" data-name="' + name + '" data-jarName="' + res.jarName + '" onfocus="menubarnonroot(this.getAttribute(\'data-jarName\'), this.getAttribute(\'data-name\'));"> <div style="height:64px;"> <center><img width="50px" height="50px" src="' + url + '" onerror="this.src=\'java.png\'"></img></center> </div><div class="version">' + jarVersion + '</div></a>');
						} catch (err) {
							url = 'java.png';
							listapp.push('<a class="game focusable" tabindex="' + (i + 1) + '" style="" href="javascript:void(0)" onclick="openJar(\'' + res.jarName + '\',0,1);" data-name="' + name + '" data-jarName="' + res.jarName + '"  onfocus="menubarnonroot(this.getAttribute(\'data-jarName\'), this.getAttribute(\'data-name\'));"> <div style="height:64px;"> <center><img width="50px" height="50px" src="' + url + '" onerror="this.src=\'java.png\'"></img></center> </div><div class="version">' + jarVersion + '</div></a>');
							console.log(err)
						}
					}
					applist.innerHTML = listapp.join('');
				},
				(err) => {
					alert(err);
				}
			);
		}

		function loadLocalJar() {
			closemenubar();
			var localjars = document.getElementById('localjars');
			if (localjars.options.length == 0) {
				alert('Please upload jar first!');
				return;
			}
			if (localjars.selectedIndex < 0 || localjars.selectedIndex >= localjars.options.length) {
				alert('Please select a jar name!');
				return;
			}
			var jarname = localjars.options[localjars.selectedIndex].text;
			console.log(jarname);
			openJar(jarname, '', 1);

		}

		function alertSuccess(successcount, failcount) {
			alert('Installation completed, success ' + successcount + ', failure ' + failcount + '');
		}

		function deleteLocalJar() {
			closemenubar();
			// var localjars = document.getElementById('localjars');
			// if (localjars.options.length == 0) {
			// 	alert('There are no jars to delete!');
			// 	return;
			// }
			// if (localjars.selectedIndex < 0 || localjars.selectedIndex >= localjars.options.length) {
			// 	alert('Please select a jar name!');
			// 	return;
			// }
			// var jarname = localjars.options[localjars.selectedIndex].text;
			// console.log(jarname);
			let res = confirm('Uninstall ' + baseFileName(localStorage.getItem('focusedJar')) + ' ？');
			if (res) {
				JARStore.deleteJar(localStorage.getItem('focusedJar')).then(
					() => {
						alert(baseFileName(localStorage.getItem('focusedJar')) + ' Removed！');
						refreshGameList();
						localStorage.removeItem('focusedJar');
					},
					(errname) => {
						alert(errname + 'Deletion failed！');
					}
				);
			}
		}

		function clearLocalJar() {
			closemenubar();
			let res = confirm('All Jar Files Will Be Clear. Are You Sure ？');
			if (res) {
				JARStore.clear().then(
					() => {
						alert(jarname + ' Cleared！');
					},
					(errname) => {
						alert(errname + ' Can\'t Remove！');
					}
				);
				refreshGameList();
			}
		}

		var onUploadFile = function (e) {
			closemenubar();
			const _files = e.target.files;
			if (_files.length == 0) {
				return;
			}
			var successcount = 0;
			var failcount = 0;
			var allcount = _files.length;
			for (var i = 0; i < _files.length; i++) {
				const _file = _files[i];
				if (!_file.name.toLowerCase().endsWith('.jar')) {
					//alert('Only jar format can be uploaded!');
					//return;
					failcount++;
					continue;
				}
				//fs.createUniqueFile('/Phone',_file.name,_file);
				const reader = new FileReader();
				reader.readAsArrayBuffer(_file);
				reader.onload = function (readRes) {
					JARStore.installJAR(_file.name, readRes.target.result).then(
						() => {
							successcount++;
							if (successcount + failcount >= allcount) {
								alertSuccess(successcount, failcount);
								refreshGameList();
							}
						},
						(errname) => {
							failcount++;
							if (successcount + failcount >= allcount) {
								alertSuccess(successcount, failcount);
								refreshGameList();
							}
						}
					);
					document.getElementById('jarFileupload').value = null;
				}
			}
		}

		var config = function () {
			var myInfo = {
				canvasSize: 4,
				gamepadSize: 0,
				gameresize: 0,
				gameindex: 0,
			};
			if (window.localStorage['my'] === undefined) {
				window.localStorage['my'] = JSON.stringify(myInfo);
			} else {
				var data = JSON.parse(window.localStorage['my']);
				for (var key in data) {
					myInfo[key] = data[key];
				}
			}
			return {
				getValueByKey(key) {
					return myInfo[key]
				},
				setValueByKey() {
					for (var i = 0; i < arguments.length; i += 2) {
						myInfo[arguments[i]] = arguments[i + 1];
					}
					window.localStorage['my'] = JSON.stringify(myInfo);
				}
			}
		}

		var config01 = new config();
		window.addEventListener('load', () => {

			var csize = config01.getValueByKey('canvasSize');
			var gsize = config01.getValueByKey('gamepadSize');
			var gresize = config01.getValueByKey('gameresize');

			var gamepadSize = document.getElementById('gamepadSize');
			var canvasSize = document.getElementById('canvasSize');
			var gameresize = document.getElementById('gameresize');


			canvasSize.selectedIndex = csize;
			gamepadSize.selectedIndex = gsize;
			gameresize.selectedIndex = gresize;

			document.getElementById('jarFileupload').addEventListener('change', onUploadFile);
			refreshGameList();

			navigator.mozSetMessageHandler('activity', function (activityReq) {
				var _file = activityReq.source.data.blob;
				var reader = new FileReader();
				reader.readAsArrayBuffer(_file);
				reader.onload = function (readRes) {
					JARStore.installJAR(_file.name, readRes.target.result).then(
						() => {
							alertSuccess(1, 0);
							refreshGameList();
						},
						(errname) => {
							alertSuccess(0, 1);
							refreshGameList();
						}
					);
					document.getElementById('jarFileupload').value = null;
				}
			});
		});



		function openLocalJar() {
			closemenubar();
			document.getElementById('jarFileupload').click();

		}

		function openJar(jarname, midletClassName, islocaljar) {
			closemenubar();

			var href = 'main.html?jars=jar/' + jarname + '&jad=&midletClassName=' + midletClassName;
			if (islocaljar) {
				href = 'main.html?localjar=' + jarname;
			}

			// var gamepadSize = document.getElementById('gamepadSize');
			// var mvalue = gamepadSize.options[gamepadSize.selectedIndex].value;
			// if (mvalue) {
			// href += '&gamepadSize=' + mvalue;
			// if (gamepadSize.selectedIndex == 0) {
			href += '&gamepad=0';
			// } else {
			// 	href += '&gamepad=1';
			// }
			// }

			// var canvasSize = document.getElementById('canvasSize');
			// var mvalue = canvasSize.options[canvasSize.selectedIndex].value;
			// if (mvalue) {
			// 	href += '&canvasSize=' + mvalue;
			// }

			if (localStorage.getItem(localStorage.getItem('focusedJar')) == '') {
				href += '&canvasSize=size-no';
			} else {
				href += '&canvasSize=size-' + localStorage.getItem(localStorage.getItem('focusedJar'));
			}

			var gameresize = document.getElementById('gameresize');
			var gameresizevalue = gameresize.options[gameresize.selectedIndex].value;
			if (gameresizevalue) {
				href += '&gameresize=' + gameresizevalue;
			}

			var localjars = document.getElementById('localjars');

			config01.setValueByKey('canvasSize', canvasSize.selectedIndex);
			config01.setValueByKey('gamepadSize', gamepadSize.selectedIndex);
			config01.setValueByKey('gameresize', gameresize.selectedIndex);
			config01.setValueByKey('gameindex', localjars.selectedIndex)

			window.location.href = href;
			//http://127.0.0.1:3000/main.html?localjar=Bounce-tales-(dhanush100.wapkiz.com).jar&gamepadSize=gamepad-0&gamepad=0&canvasSize=size-no&gameresize=resize-1
		}

		navigator.mozSetMessageHandler('activity', function (activityReq) {
			var _file = activityReq.source.data.blob;
			var reader = new FileReader();
			reader.readAsArrayBuffer(_file);
			reader.onload = function (readRes) {
				JARStore.installJAR(_file.name, readRes.target.result).then(
					() => {
						alertSuccess(1, 0);
						refreshGameList();
					},
					(errname) => {
						alertSuccess(0, 1);
						refreshGameList();
					}
				);
				document.getElementById('jarFileupload').value = null;
			}
		});


		document.addEventListener('DOMContentLoaded', () => {
			getKaiAd({
				publisher: '080b82ab-b33a-4763-a498-50f464567e49',
				app: 'java',
				slot: 'java',
				onerror: (err) => console.error('Custom catch:', err),
				onready: (ad) => {
					ad.call('display');
				},
			});
		});

		document.body.addEventListener('keyup', () => {
			getKaiAd({
				publisher: '080b82ab-b33a-4763-a498-50f464567e49',
				app: 'java',
				slot: 'java',
				onerror: (err) => console.error('Custom catch:', err),
				onready: (ad) => {
					ad.call('display');
				},
			});
		});
	</script>
	<div style="display:flex;flex-wrap: wrap; margin: 10px 0px;float:left;align-items: center;" id="gamepanel">
	</div>

	<!-- <label><input id="mycheck1" name="enablekey" type="checkbox"  checked value="" />Enable Button</label> -->
	<!-- <label><input id="mycheck2" name="enablexy" type="checkbox" value="" />Adaptive Scaling</label>  -->
	<div style="margin-top: 100px; clear: both;display: none;">

		<select id="canvasSize" class="filter-box">
			<option value="size-240x320">Display size: 240x320</option>
			<option value="size-320x240">Display size: 320x240</option>
			<option value="size-360x640">Display size: 360x640</option>
			<option value="size-640x360">Display size: 640x360</option>
			<option value="size-no" selected>Display size: Any</option>
		</select>
		<select id="gamepadSize" class="filter-box">
			<option value="gamepad-0" selected>Virtual Keyboard - None</option>
			<option value="gamepad-1">Virtual Keyboard - Small</option>
			<option value="gamepad-2">Virtual Keyboard-MIddle</option>
			<option value="gamepad-3">Virtual Keyboard-Big</option>
			<option value="gamepad-4">Virtual Keyboard-Extra Big</option>
		</select>

		<select id="gameresize" class="filter-box">
			<option value="resize-1" selected>None</option>
			<option value="resize-1x5">Zoom 1.5x</option>
			<option value="resize-2">Zoom 2x</option>
			<option value="resize-2x5">Zoom 2.5x</option>
			<option value="resize-3">Zoom 3x</option>
		</select>
		</br>
		</br>
		<select id="localjars" class="filter-box">
			<option value="" selected>Select</option>
		</select>
		<button class="btn" onclick="openLocalJar()">
			Install jar
		</button>

		<button class="btn" onclick="loadLocalJar()">
			Open jar
		</button>

		<button class="btn" onclick="deleteLocalJar()">
			Uninstall jar
		</button>
		<button class="btn" onclick="clearLocalJar()">
			Clear jar
		</button>

		</br>
		</br>
		</br>
		</br>
		<a href="index.html" style="float: right;">
			Standard version
		</a>
		</br>
		</br>
		<a href="updatelog.html" style="float: right;">
			Changelog
		</a>
		</br>
		</br>
	</div>


	<script>
		navigator.mozSetMessageHandler('activity', function (activityReq) {
			var _file = activityReq.source.data.blob;
			var reader = new FileReader();
			reader.readAsArrayBuffer(_file);
			reader.onload = function (readRes) {
				JARStore.installJAR(_file.name, readRes.target.result).then(
					() => {
						alertSuccess(1, 0);
						refreshGameList();
					},
					(errname) => {
						alertSuccess(0, 1);
						refreshGameList();
					}
				);
				document.getElementById('jarFileupload').value = null;
			}
		});

		// setInterval(function () {
		// 	for (var x = 0; x < document.querySelectorAll('.focusable').length; x++) {
		// 		document.querySelectorAll('.focusable')[x].addEventListener('focus', function () {
		// 			document.querySelectorAll('.header')[0].innerHTML = this.getAttribute('data-name');
		// 			localStorage.setItem('focusedJar', this.getAttribute('data-jarName'));
		// 		})
		// 	}
		// }, 1000);

		document.body.addEventListener('keydown', keydownlisterner);

		function keydownlisterner(e) {
			switch (e.key) {
				case 'ArrowDown':
					focus(3);
					break;
				case 'ArrowUp':
					focus(-3);
					break;
				case 'Down':
					focus(3);
					break;
				case 'Up':
					focus(-3);
					break;
				case 'ArrowRight':
					focus(1);
					break;
				case 'ArrowLeft':
					focus(-1);
					break;
				case 'Right':
					focus(1);
					break;
				case 'Left':
					focus(-1);
					break;
				case 'Enter':
					document.activeElement.click();
					break;
				case 'SoftRight':
					localStorage.removeItem('focusedJar');
					window.close();
					break;
				case 'f2':
					localStorage.removeItem('focusedJar');
					window.close();
					break;
				case 'SoftLeft':
					openmenubar();
					break;
				case 'f1':
					openmenubar();
					break;

			}


			function focus(move) {
				var currentIndex = document.activeElement.tabIndex;
				var next = currentIndex + move;
				if (next > document.querySelectorAll('.focusable').length - 1) { next = 0; } else if (next < 0) { next = document.querySelectorAll('.focusable').length - 1; }
				var items = document.querySelectorAll('.focusable');
				var targetElement = items[next];
				targetElement.focus();
				targetElement.scrollIntoView({ block: 'center' });
			}

		}

		function keydownmenubar(e) {
			switch (e.key) {
				case 'ArrowUp':
					focus(-1);
					break;
				case 'ArrowDown':
					focus(1);
					break;
				case 'Enter':
					document.activeElement.click();
					break;
				case 'F2':
					closemenubar();
					break;
				case 'SoftRight':
					closemenubar();
					break;
			}

			function focus(move) {
				var currentIndex = document.activeElement.tabIndex;
				var next = currentIndex + move;
				if (next > document.querySelectorAll('.menuelement').length - 1) { next = 0; } else if (next < 0) { next = document.querySelectorAll('.menuelement').length - 1; }
				var items = document.querySelectorAll('.menuelement');
				var targetElement = items[next];
				targetElement.focus();

			}
		}

		function keydownlocalconfig(e) {
			if (e.key == 'ArrowUp') { document.querySelectorAll('.screeninput')[0].focus(); }
			if (e.key == 'ArrowDown') { document.querySelectorAll('.screeninput')[1].focus(); }
			if (e.key == 'Enter') {
				if (parseInt(document.querySelectorAll('.screeninput')[0].value) == '' || parseInt(document.querySelectorAll('.screeninput')[1].value) == '' || parseInt(document.querySelectorAll('.screeninput')[0].value) == 0 || parseInt(document.querySelectorAll('.screeninput')[1].value) == 0) {
					if (confirm('Sure To Remove Config ?')) {
						localStorage.removeItem(localStorage.getItem('focusedJar'));
						f1.innerHTML = 'Menu';
						f2.innerHTML = 'OK';
						document.body.addEventListener('keydown', keydownmenubar);
						document.body.removeChild(document.querySelector('#localconfigbar'));
					} else { alert('Enter A Correct Value'); }
				} else {
					localStorage.setItem(localStorage.getItem('focusedJar'), document.querySelectorAll('.screeninput')[0].value + 'x' + document.querySelectorAll('.screeninput')[1].value);
					f1.innerHTML = 'Menu';
					f2.innerHTML = 'OK';
					document.body.addEventListener('keydown', keydownmenubar);
					document.body.removeChild(document.querySelector('#localconfigbar'));
				}
			}
			if (e.key == 'SoftRight') {
				f1.innerHTML = 'Menu';
				f2.innerHTML = 'OK';
				document.body.addEventListener('keydown', keydownmenubar);
				document.body.removeChild(document.querySelector('#localconfigbar'));
			}
		}
	</script>
</body>

</html>